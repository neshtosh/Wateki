<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="images/wtki icon.png">
  <title>Wateki</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:200,300,400,600,700,800,900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="css/animate.css">
  
  <link rel="stylesheet" href="css/owl.carousel.min.css">
  <link rel="stylesheet" href="css/owl.theme.default.min.css">
  <link rel="stylesheet" href="css/magnific-popup.css">
  
  <link rel="stylesheet" href="css/flaticon.css">
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* Blog Posts Container */
    #blog-posts-container {
      width: 90em !important;
      margin-left: -25%;
      
      min-height: 200px !important;
      background: #fff !important;
      padding: 40px !important;
      border-radius: 8px !important;
      box-shadow: 0 0 20px rgba(0,0,0,0.05) !important;
      display: grid !important;
      grid-template-columns: repeat(4, 1fr) !important;
      gap: 30px !important;
    }

    /* Blog Entry Card */
    .blog-entry {
      background: #fff !important;
      border-radius: 8px !important;
      overflow: hidden !important;
      transition: all 0.3s ease !important;
      margin-bottom: 0 !important; /* Remove bottom margin since we're using grid gap */
      box-shadow: 0 0 15px rgba(0,0,0,0.05) !important;
      border: 1px solid rgba(0,0,0,0.05) !important;
      width: 100% !important; /* Make cards fill their grid cell */
      display: flex !important;
      flex-direction: column !important;
    }

    .blog-entry:hover {
      transform: translateY(-5px) !important;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1) !important;
    }

    .blog-entry .text {
      padding: 25px !important;
      flex-grow: 1 !important; /* Allow text section to grow and fill space */
      display: flex !important;
      flex-direction: column !important;
    }

    .blog-entry .heading {
      font-size: 22px !important;
      font-weight: 600 !important;
      margin-bottom: 15px !important;
      line-height: 1.4 !important;
      font-family: "Nunito Sans", sans-serif !important;
    }

    .blog-entry .heading a {
      color: #2c3e50 !important;
      text-decoration: none !important;
      transition: color 0.3s ease !important;
    }

    .blog-entry .heading a:hover {
      color: #F96D00 !important;
    }

    .blog-entry .block-20 {
      height: 200px !important; /* Fixed height for consistency */
      background-size: cover !important;
      background-position: center !important;
      border-radius: 8px 8px 0 0 !important;
    }

    .blog-entry .meta {
      color: #666 !important;
      font-size: 14px !important;
      margin-bottom: 15px !important;
      font-family: "Nunito Sans", sans-serif !important;
    }

    .blog-entry .meta a {
      color: #666 !important;
      text-decoration: none !important;
      margin-right: 15px !important;
      transition: color 0.3s ease !important;
    }

    .blog-entry .meta a:hover {
      color: #F96D00 !important;
    }

    .blog-entry .meta-chat {
      color: #666 !important;
    }

    .blog-entry p {
      color: #555 !important;
      line-height: 1.6 !important;
      margin-bottom: 0 !important;
      font-family: "Nunito Sans", sans-serif !important;
    }

    /* Pagination */
    .block-27 ul {
      padding: 0 !important;
      margin: 0 !important;
    }

    .block-27 ul li {
      display: inline-block !important;
      margin: 0 4px !important;
    }

    .block-27 ul li a,
    .block-27 ul li span {
      display: block !important;
      width: 40px !important;
      height: 40px !important;
      line-height: 40px !important;
      background: #fff !important;
      border-radius: 50% !important;
      text-align: center !important;
      color: #2c3e50 !important;
      font-size: 16px !important;
      font-weight: 600 !important;
      transition: all 0.3s ease !important;
      box-shadow: 0 0 10px rgba(0,0,0,0.05) !important;
      border: 1px solid rgba(0,0,0,0.05) !important;
    }

    .block-27 ul li.active span,
    .block-27 ul li a:hover {
      background: #F96D00 !important;
      color: #fff !important;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      #blog-posts-container {
        grid-template-columns: repeat(3, 1fr) !important;
      }
    }
    @media (max-width: 900px) {
      #blog-posts-container {
        grid-template-columns: repeat(2, 1fr) !important;
        width: 100% !important;
        margin-left: 0 !important;
      }
    }
    @media (max-width: 600px) {
      #blog-posts-container {
        grid-template-columns: 1fr !important;
        width: 100% !important;
        margin-left: 0 !important;
        padding: 15px !important;
      }
    }
  </style>
</head>
<body>
  
 <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
   <div class="container">
     <a class="navbar-brand" href="index.html">Wa<span>teki</span></a>
     <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
       <span class="oi oi-menu"></span> Menu
     </button>

     <div class="collapse navbar-collapse" id="ftco-nav">
       <ul class="navbar-nav ml-auto">
         <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
         <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
         <li class="nav-item"><a href="work.html" class="nav-link">Work</a></li>
         <li class="nav-item active"><a href="blog.html" class="nav-link">Blog</a></li>
         <li class="nav-item"><a href="contact.html" class="nav-link">Contact</a></li>
       </ul>
     </div>
   </div>
 </nav>

 
 <!-- END nav -->


 <section class="hero-wrap hero-wrap-2 degree-right" style="background-image: url('images/bg3.jpg');" data-stellar-background-ratio="0.5">
  <div class="overlay"></div>
  <div class="container">
    <div class="row no-gutters slider-text js-fullheight align-items-end">
      <div class="col-md-9 ftco-animate pb-5 mb-5">
       <p class="breadcrumbs"><span class="mr-2"><a href="index.html">Home <i class="fa fa-chevron-right"></i></a></span> <span>Blog <i class="fa fa-chevron-right"></i></span></p>
       <h1 class="mb-3 bread">Blog</h1>
     </div>
   </div>
 </div>
</section>


<section class="ftco-section">
  <div class="container">
    <div id="blog-posts-container" style="width: 100%; min-height: 200px; background: #f8d7da;  padding: 30px 10px 10px 10px;">
      <!-- Blog posts will be dynamically loaded here -->
      <div style="background: yellow; color: black; padding: 20px;">TEST ELEMENT</div>
      <!-- Example static post for debugging -->
      <div class="blog-entry" style="width: 300px; margin: 20px auto; border: 2px solid #007bff;">
        <div class="text">
          <h3 class="heading mb-3"><a href="#">Static Post Title</a></h3>
          <a href="#" class="block-20 img" style="background-image: url('https://images.unsplash.com/photo-1743380628166-7d...'); height: 200px; background-size: cover; background-position: center;"></a>
         <div class="meta mb-3">
            <div><a href="#">2024-01-01</a></div>
          <div><a href="#">Admin</a></div>
            <div><a href="#" class="meta-chat"><span class="fa fa-comment"></span> 0</a></div>
          </div>
          <p>This is a static post preview for debugging.</p>
</div>
</div>
</div>
<div class="row mt-5 pb-5">
  <div class="col text-center">
    <div class="block-27">
      <ul>
        <li><a href="#">&lt;</a></li>
        <li class="active"><span>1</span></li>
        <li><a href="#">2</a></li>
        <li><a href="#">3</a></li>
        <li><a href="#">4</a></li>
        <li><a href="#">5</a></li>
        <li><a href="#">&gt;</a></li>
      </ul>
    </div>
  </div>
</div>
</div>
</section>	

<footer class="ftco-footer ftco-section">
 <div class="degree-footer-top"></div>
 <div class="container">
  <div class="row mb-5">
    <div class="col-md">
      <div class="ftco-footer-widget mb-4">
        <h2 class="ftco-heading-2">Wateki.</h2>
        <p>Innovating for a Sustainable Future.</p>
        <ul class="ftco-footer-social list-unstyled mt-5">
          <li class="ftco-animate"><a href="#"><span class="fa fa-twitter"></span></a></li>
          <li class="ftco-animate"><a href="#"><span class="fa fa-facebook"></span></a></li>
          <li class="ftco-animate"><a href="#"><span class="fa fa-instagram"></span></a></li>
        </ul>
      </div>
    </div>
    <div class="col-md">
      <div class="ftco-footer-widget mb-4 ml-md-4">
        <h2 class="ftco-heading-2">Community</h2>
        <ul class="list-unstyled">
          <li><a href="work.html"><span class="fa fa-chevron-right mr-2"></span>Projects</a></li>
          <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Team</a></li>
          <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Reviews</a></li>
          <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>FAQs</a></li>
        </ul>
      </div>
    </div>
    <div class="col-md">
      <div class="ftco-footer-widget mb-4 ml-md-4">
        <h2 class="ftco-heading-2">About Us</h2>
        <ul class="list-unstyled">
          <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Our Story</a></li>
          <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Meet the team</a></li>
          <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Careers</a></li>
        </ul>
      </div>
    </div>
    <div class="col-md">
     <div class="ftco-footer-widget mb-4">
      <h2 class="ftco-heading-2">Company</h2>
      <ul class="list-unstyled">
        <li><a href="about.html"><span class="fa fa-chevron-right mr-2"></span>About Us</a></li>
        <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Press</a></li>
        <li><a href="contact.html"><span class="fa fa-chevron-right mr-2"></span>Contact</a></li>
        <li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Careers</a></li>
      </ul>
    </div>
  </div>
  <div class="col-md">
    <div class="ftco-footer-widget mb-4">
     <h2 class="ftco-heading-2">Have a Questions?</h2>
     <div class="block-23 mb-3">
       <ul>
         <li><span class="icon fa fa-map"></span><span class="text">Nairobi, Kenya</span></li>
         <li><a href="#"><span class="icon fa fa-phone"></span><span class="text">+254 755 234 567</span></a></li>
         <li><a href="#"><span class="icon fa fa-envelope pr-4"></span><span class="text">info@wateki.org</span></a></li>
       </ul>
     </div>
   </div>
 </div>
</div>
<div class="row">
  <div class="col-md-12 text-center">
   
    <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
      Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved </a>
      <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
    </div>
  </div>
</div>
</footer>



<!-- loader -->
<div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


<script src="js/jquery.min.js"></script>
<script src="js/jquery-migrate-3.0.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/jquery.waypoints.min.js"></script>
<script src="js/jquery.stellar.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.magnific-popup.min.js"></script>
<script src="js/jquery.animateNumber.min.js"></script>
<script src="js/scrollax.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
<script src="js/google-map.js"></script>
<script src="js/main.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const blogPostsContainer = document.getElementById('blog-posts-container');
    console.log('Blog page loaded, initializing...');
    
    // Connect to WebSocket
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const wsUrl = `${wsProtocol}//${window.location.host}`;
    console.log('Connecting to WebSocket at:', wsUrl);
    const ws = new WebSocket(wsUrl);

    ws.onopen = function() {
        console.log('WebSocket connected successfully');
        // Request initial posts
        console.log('Requesting initial posts...');
        fetch('/api/posts')
            .then(response => response.json())
            .then(posts => {
                console.log('Received posts from server:', posts);
                displayPosts(posts);
            })
            .catch(error => console.error('Error fetching posts:', error));
    };

    ws.onmessage = function(event) {
        try {
            const data = JSON.parse(event.data);
            console.log('Received WebSocket message:', data);
            if (data.type === 'posts_updated') {
                console.log('Updating posts display with new data');
                displayPosts(data.posts);
            }
        } catch (error) {
            console.error('Error processing message:', error);
        }
    };

    function displayPosts(posts) {
        blogPostsContainer.innerHTML = ''; // Clear previous content

        if (!posts || Object.keys(posts).length === 0) {
            blogPostsContainer.innerHTML = '<div class="col-12 text-center"><p>No blog posts available. Create your first post in the admin panel!</p></div>';
            return;
        }

        Object.entries(posts).forEach(([id, post]) => {
            // Format date
            let dateStr = post.date ? new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: '2-digit' }) : '';
            // Snippet of content
            let snippet = post.content ? post.content.split(' ').slice(0, 20).join(' ') + (post.content.split(' ').length > 20 ? '...' : '') : '';
            // Number of comments
            let comments = post.comments ? post.comments.length : (post.commentCount || 0);
            
            const postElement = document.createElement('div');
            postElement.className = 'blog-entry';
            postElement.innerHTML = `
                <div class="text">
                    <h3 class="heading mb-3"><a href="blog-single.html?id=${id}">${post.title}</a></h3>
                    <a href="blog-single.html?id=${id}" class="block-20 img" style="background-image: url('${post.image}');"></a>
                    <div class="meta mb-3">
                        <div><a href="#">${dateStr || 'Unknown Date'}</a></div>
                        <div><a href="#">Admin</a></div>
                        <div><a href="#" class="meta-chat"><span class="fa fa-comment"></span> ${comments}</a></div>
                    </div>
                    <p>${snippet}</p>
                </div>
            `;
            blogPostsContainer.appendChild(postElement);
        });
    }

    ws.onerror = function(error) {
        console.error('WebSocket error:', error);
    };

    ws.onclose = function() {
        console.log('WebSocket connection closed');
    };
});
</script>

<div id="blog-content"><!-- Blog content will be loaded here --></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get the post ID from the URL
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');
    const blogContent = document.getElementById('blog-content');

    if (!postId) {
        blogContent.innerHTML = '<p>Blog post not found.</p>';
        return;
    }

    // Fetch the blog post from the server
    fetch(`/api/posts/${postId}`)
        .then(response => {
            if (!response.ok) throw new Error('Post not found');
            return response.json();
        })
        .then(post => {
            // Debug: log the post object
            console.log('Rendering post:', post);
            blogContent.innerHTML = `
                <h2>${post.title}</h2>
                <img src="${post.image}" alt="${post.title}" style="max-width:100%;margin-bottom:20px;">
                <div>${post.content}</div>
            `;
        })
        .catch((err) => {
            blogContent.innerHTML = '<p>Blog post not found.</p>';
            console.error('Error rendering post:', err);
        });
});
</script>

</body>
</html>